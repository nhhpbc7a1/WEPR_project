<div class="container">
  {{#if showErrors}}
  <div class="alert alert-danger" role="alert">
    Sai tên tài khoản hoặc mật khẩu!
  </div>
  {{/if}}
  <div style="font-family: Arial, sans-serif; max-width: 800px; margin: 50px auto; display: flex; background: #fff; border: 1px solid #ddd; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
    <!-- Cột bên trái -->
    <div style="width: 50%; padding: 30px; border-right: 1px solid #ddd;">
      <h2 style="color: #333; font-size: 24px; margin-bottom: 20px;">Đăng nhập VnExpress</h2>
      <p style="font-size: 14px; color: #555; margin-bottom: 20px;">Để sử dụng đầy đủ tính năng đọc báo và tham gia cộng đồng hơn 8 triệu thành viên</p>
      <form id="frmLogin" action="/account/login" method="POST">
        <div style="margin-bottom: 20px;">
          <input id="txtUsername" type="text" name="username" placeholder="Nhập username" required
            style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; box-sizing: border-box;">
        </div>
        <div style="margin-bottom: 20px;">
          <input id="txtPassword" type="password" name="raw_password" placeholder="Nhập mật khẩu" required
            style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; box-sizing: border-box;">
        </div>
        <button type="submit"
          style="width: 100%; padding: 10px; background-color: #888; color: white; font-size: 14px; border: none; border-radius: 4px; cursor: pointer;">
          Đăng nhập
        </button>
        <div class="footer">
          <p>Chưa có tài khoản? <a href="/signup">Tạo tài khoản</a></p>
        </div>
      </form>
      <p style="font-size: 12px; color: #888; margin-top: 15px;">Bạn tạo tài khoản là đồng ý với
        <a href="#" style="color: #007bff; text-decoration: none;">quy định</a>,
        <a href="#" style="color: #007bff; text-decoration: none;">điều khoản sử dụng</a>
        và <a href="#" style="color: #007bff; text-decoration: none;">chính sách bảo mật</a> của VnExpress.
      </p>
    </div>

    <!-- Cột bên phải -->
    <div style="width: 50%; padding: 30px; background-color: #f8f9fa;">
      <h2 style="color: #333; font-size: 24px; margin-bottom: 20px;">Đăng nhập tài khoản với</h2>
        <button
        id="facebook-login-btn"
         style="width: 100%; padding: 10px; margin-bottom: 15px; background-color: #4267B2; color: white; font-size: 14px; border: none; border-radius: 4px; cursor: pointer;">
        Facebook
      </button>
      
      <!-- Nút Google Login (Google Identity Services sẽ render nó) -->
        <button 
    id="google-login-btn" 
    style="width: 100%; padding: 10px; margin-bottom: 15px; background-color: #DB4437; color: white; font-size: 14px; border: none; border-radius: 4px; cursor: pointer;">
     Google
  </button>

      <!-- Form ẩn để xử lý Google Login -->
      <form id="frmGoogleLogin" action="/account/auth/google" method="POST" style="display: none;">
        <input type="hidden" name="id_token" id="google-id-token">
      </form>

    </div>
  </div>
</div>

{{#section 'js'}}
<script src="https://accounts.google.com/gsi/client" async defer></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

<script>
   function handleCredentialResponse(response) {
    console.log('Encoded JWT ID token:', response.credential);

    // Gửi token tới backend
    const idTokenInput = document.getElementById('google-id-token');
    idTokenInput.value = response.credential;

    const googleLoginForm = document.getElementById('frmGoogleLogin');
    googleLoginForm.submit();
  }

  window.onload = function () {
    google.accounts.id.initialize({
      client_id: '27591522593-3vh6610g3n58hreubc5o3eatbv52ohi7.apps.googleusercontent.com',
      callback: handleCredentialResponse
    });

    // Sự kiện click vào nút Google login
    document.getElementById('google-login-btn').addEventListener('click', function() {
      google.accounts.id.prompt(); // Gọi Google Sign-In
    });
  };

  // Xử lý form đăng nhập thông thường
  document.getElementById('frmLogin').addEventListener('submit', function (event) {
    const username = document.getElementById('txtUsername').value.trim();
    const password = document.getElementById('txtPassword').value.trim();

    if (!username || !password) {
      alert('Vui lòng nhập đầy đủ thông tin.');
      event.preventDefault(); // Ngăn form gửi dữ liệu
    }
  });
</script>
<script>

  document.getElementById('facebook-login-btn').addEventListener('click', function() {
  FB.login(function(response) {
  if (response.authResponse) {
    const accessToken = response.authResponse.accessToken;
    $.post('/account/auth/facebook', { accessToken: accessToken })
      .done(function() {
        window.location.href = '/';
      })
      .fail(function(error) {
        alert('Lỗi đăng nhập với Facebook! Chi tiết: ' + error.responseText); 
      });
  } else {
    alert('Đăng nhập với Facebook thất bại!');  
  }
}, {scope: 'email, public_profile'});

  });

   window.fbAsyncInit = function () { 
    FB.init({
      appId      : '451779097775725',  
      cookie     : true, 
      xfbml      : true, 
      version    : 'v21.0'  
    }); 

    FB.AppEvents.logPageView();  
  };

  (function(d, s, id){
    var js, fjs = d.getElementsByTagName(s)[0]; 
    if (d.getElementById(id)) { 
      return; 
    } 
    js = d.createElement(s); 
    js.id = id; 
    js.src = "https://connect.facebook.net/en_US/sdk.js"; 
    fjs.parentNode.insertBefore(js, fjs); 
  })(document, 'script', 'facebook-jssdk');
</script>
{{/section}}
